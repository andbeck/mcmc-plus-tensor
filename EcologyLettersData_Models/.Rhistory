?pca
?prcomp
?princomp
# Requires the following libraries
library(mvtnorm)
library(MASS)
library(MCMCglmm)
##------------------------------------------------------------------------------------------------------
## Generate G matrices for multiple traits
##------------------------------------------------------------------------------------------------------
set.seed(123)
G_1<-matrix(c(
1.0,   0.8,   0.8,   0.8,   0.8,   0.8,   0.8,   0.8,   0.8,   0.8,
0.8,   1.0,   0.8,   0.8,   0.8,   0.8,   0.8,   0.8,   0.8,   0.8,
0.8,   0.8,   1.0,   0.8,   0.8,   0.8,   0.8,   0.8,   0.8,   0.8,
0.8,   0.8,   0.8,   1.0,   0.8,   0.8,   0.8,   0.8,   0.8,   0.8,
0.8,   0.8,   0.8,   0.8,   1.0,   0.8,   0.8,   0.8,   0.8,   0.8,
0.8,   0.8,   0.8,   0.8,   0.8,   1.0,   0.8,   0.8,   0.8,   0.8,
0.8,   0.8,   0.8,   0.8,   0.8,   0.8,   1.0,   0.8,   0.8,   0.8,
0.8,   0.8,   0.8,   0.8,   0.8,   0.8,   0.8,   1.0,   0.8,   0.8,
0.8,   0.8,   0.8,   0.8,   0.8,   0.8,   0.8,   0.8,   1.0,   0.8,
0.8,   0.8,   0.8,   0.8,   0.8,   0.8,   0.8,   0.8,   0.8,   1.0),10,10)
bv_1 <- lapply(1, mvrnorm, n=200, mu=rep(0,10), Sigma=G_1)
sire1<-lapply(bv_1, function(x) data.frame(sire=rep(1:nrow(x),each=4), rpt=rep(1:4,nrow(x)),
res1=rnorm(800,0,1.35^2),res2=rnorm(800,0,1.35^2),res3=rnorm(800,0,1.35^2),res4=rnorm(800,0,1.35^2),res5=rnorm(800,0,1.35^2),res6=rnorm(800,0,1.35^2),res7=rnorm(800,0,1.35^2),res8=rnorm(800,0,1.35^2),res9=rnorm(800,0,1.35^2),res10=rnorm(800,0,1.35^2),
bv1=rep(x[,1],each=4),bv2=rep(x[,2],each=4),bv3=rep(x[,3],each=4),bv4=rep(x[,4],each=4),bv5=rep(x[,5],each=4),bv6=rep(x[,6],each=4),bv7=rep(x[,7],each=4),bv8=rep(x[,8],each=4),bv9=rep(x[,9],each=4),bv10=rep(x[,10],each=4)))
data1<-lapply(sire1, function(x) cbind(x, trait1=x$res1+x$bv1, trait2=x$res2+x$bv2, trait3=x$res3+x$bv3,trait4=x$res4+x$bv4,trait5=x$res5+x$bv5,trait6=x$res6+x$bv6,trait7=x$res7+x$bv7,trait8=x$res8+x$bv8,trait9=x$res9+x$bv9,trait10=x$res10+x$bv10))
G_2<-matrix(c(
1.0,   0.8,   0.8,   0.8,   0.8,  -0.8,  -0.8,  -0.8,  -0.8,  -0.8,
0.8,   1.0,   0.8,   0.8,   0.8,  -0.8,  -0.8,  -0.8,  -0.8,  -0.8,
0.8,   0.8,   1.0,   0.8,   0.8,  -0.8,  -0.8,  -0.8,  -0.8,  -0.8,
0.8,   0.8,   0.8,   1.0,   0.8,  -0.8,  -0.8,  -0.8,  -0.8,  -0.8,
0.8,   0.8,   0.8,   0.8,   1.0,  -0.8,  -0.8,  -0.8,  -0.8,  -0.8,
-0.8,  -0.8,  -0.8,  -0.8,  -0.8,   1.0,   0.8,   0.8,   0.8,   0.8,
-0.8,  -0.8,  -0.8,  -0.8,  -0.8,   0.8,   1.0,   0.8,   0.8,   0.8,
-0.8,  -0.8,  -0.8,  -0.8,  -0.8,   0.8,   0.8,   1.0,   0.8,   0.8,
-0.8,  -0.8,  -0.8,  -0.8,  -0.8,   0.8,   0.8,   0.8,   1.0,   0.8,
-0.8,  -0.8,  -0.8,  -0.8,  -0.8,   0.8,   0.8,   0.8,   0.8,   1.0),10,10)
bv_2 <- lapply(1, mvrnorm, n=200, mu=rep(0,10), Sigma=G_2)
sire2<-lapply(bv_2, function(x) data.frame(sire=rep(1:nrow(x),each=4), rpt=rep(1:4,nrow(x)),
res1=rnorm(800,0,1.35^2),res2=rnorm(800,0,1.35^2),res3=rnorm(800,0,1.35^2),res4=rnorm(800,0,1.35^2),res5=rnorm(800,0,1.35^2),res6=rnorm(800,0,1.35^2),res7=rnorm(800,0,1.35^2),res8=rnorm(800,0,1.35^2),res9=rnorm(800,0,1.35^2),res10=rnorm(800,0,1.35^2),
bv1=rep(x[,1],each=4),bv2=rep(x[,2],each=4),bv3=rep(x[,3],each=4),bv4=rep(x[,4],each=4),bv5=rep(x[,5],each=4),bv6=rep(x[,6],each=4),bv7=rep(x[,7],each=4),bv8=rep(x[,8],each=4),bv9=rep(x[,9],each=4),bv10=rep(x[,10],each=4)))
data2<-lapply(sire2, function(x) cbind(x, trait1=x$res1+x$bv1, trait2=x$res2+x$bv2, trait3=x$res3+x$bv3,trait4=x$res4+x$bv4,trait5=x$res5+x$bv5,trait6=x$res6+x$bv6,trait7=x$res7+x$bv7,trait8=x$res8+x$bv8,trait9=x$res9+x$bv9,trait10=x$res10+x$bv10))
G_3<-matrix(c(
1.000, 0.800, 0.800, 0.800, 0.800, 0.800, 0.980, 1.131, 1.265, 1.386,
0.800, 1.000, 0.800, 0.800, 0.800, 0.800, 0.980, 1.131, 1.265, 1.386,
0.800, 0.800, 1.000, 0.800, 0.800, 0.800, 0.980, 1.131, 1.265, 1.386,
0.800, 0.800, 0.800, 1.000, 0.800, 0.800, 0.980, 1.131, 1.265, 1.386,
0.800, 0.800, 0.800, 0.800, 1.000, 0.800, 0.980, 1.131, 1.265, 1.386,
0.800, 0.800, 0.800, 0.800, 0.800, 1.000, 0.980, 1.131, 1.265, 1.386,
0.980, 0.980, 0.980, 0.980, 0.980, 0.980, 1.500, 1.386, 1.549, 1.697,
1.131, 1.131, 1.131, 1.131, 1.131, 1.131, 1.386, 2.000, 1.789, 1.960,
1.265, 1.265, 1.265, 1.265, 1.265, 1.265, 1.549, 1.789, 2.500, 2.191,
1.386, 1.386, 1.386, 1.386, 1.386, 1.386, 1.697, 1.960, 2.191, 3.000),10,10)
bv_3 <- lapply(1, mvrnorm, n=200, mu=rep(0,10), Sigma=G_3)
sire3<-lapply(bv_3, function(x) data.frame(sire=rep(1:nrow(x),each=4), rpt=rep(1:4,nrow(x)),
res1=rnorm(800,0,1.35^2),res2=rnorm(800,0,1.35^2),res3=rnorm(800,0,1.35^2),res4=rnorm(800,0,1.35^2),res5=rnorm(800,0,1.35^2),res6=rnorm(800,0,1.35^2),res7=rnorm(800,0,1.35^2),res8=rnorm(800,0,1.35^2),res9=rnorm(800,0,1.35^2),res10=rnorm(800,0,1.35^2),
bv1=rep(x[,1],each=4),bv2=rep(x[,2],each=4),bv3=rep(x[,3],each=4),bv4=rep(x[,4],each=4),bv5=rep(x[,5],each=4),bv6=rep(x[,6],each=4),bv7=rep(x[,7],each=4),bv8=rep(x[,8],each=4),bv9=rep(x[,9],each=4),bv10=rep(x[,10],each=4)))
data3<-lapply(sire3, function(x) cbind(x, trait1=x$res1+x$bv1, trait2=x$res2+x$bv2, trait3=x$res3+x$bv3,trait4=x$res4+x$bv4,trait5=x$res5+x$bv5,trait6=x$res6+x$bv6,trait7=x$res7+x$bv7,trait8=x$res8+x$bv8,trait9=x$res9+x$bv9,trait10=x$res10+x$bv10))
G_4<-matrix(c(
1.0,   0.8,   0.8,   0.8,   0.8,   0.8,   0.6,   0.4,   0.2,   0.0,
0.8,   1.0,   0.8,   0.8,   0.8,   0.8,   0.6,   0.4,   0.2,   0.0,
0.8,   0.8,   1.0,   0.8,   0.8,   0.8,   0.6,   0.4,   0.2,   0.0,
0.8,   0.8,   0.8,   1.0,   0.8,   0.8,   0.6,   0.4,   0.2,   0.0,
0.8,   0.8,   0.8,   0.8,   1.0,   0.8,   0.6,   0.4,   0.2,   0.0,
0.8,   0.8,   0.8,   0.8,   0.8,   1.0,   0.6,   0.4,   0.2,   0.0,
0.6,   0.6,   0.6,   0.6,   0.6,   0.6,   1.5,   0.8,   0.4,   0.2,
0.4,   0.4,   0.4,   0.4,   0.4,   0.4,   0.8,   2.0,   1.0,   0.4,
0.2,   0.2,   0.2,   0.2,   0.2,   0.2,   0.4,   1.0,   2.5,   1.2,
0.0,   0.0,   0.0,   0.0,   0.0,   0.0,   0.2,   0.4,   1.2,   3.0),10,10)
bv_4 <- lapply(1, mvrnorm, n=200, mu=rep(0,10), Sigma=G_4)
sire4<-lapply(bv_4, function(x) data.frame(sire=rep(1:nrow(x),each=4), rpt=rep(1:4,nrow(x)),
res1=rnorm(800,0,1.35^2),res2=rnorm(800,0,1.35^2),res3=rnorm(800,0,1.35^2),res4=rnorm(800,0,1.35^2),res5=rnorm(800,0,1.35^2),res6=rnorm(800,0,1.35^2),res7=rnorm(800,0,1.35^2),res8=rnorm(800,0,1.35^2),res9=rnorm(800,0,1.35^2),res10=rnorm(800,0,1.35^2),
bv1=rep(x[,1],each=4),bv2=rep(x[,2],each=4),bv3=rep(x[,3],each=4),bv4=rep(x[,4],each=4),bv5=rep(x[,5],each=4),bv6=rep(x[,6],each=4),bv7=rep(x[,7],each=4),bv8=rep(x[,8],each=4),bv9=rep(x[,9],each=4),bv10=rep(x[,10],each=4)))
data4<-lapply(sire4, function(x) cbind(x, trait1=x$res1+x$bv1, trait2=x$res2+x$bv2, trait3=x$res3+x$bv3,trait4=x$res4+x$bv4,trait5=x$res5+x$bv5,trait6=x$res6+x$bv6,trait7=x$res7+x$bv7,trait8=x$res8+x$bv8,trait9=x$res9+x$bv9,trait10=x$res10+x$bv10))
G_5<-matrix(c(
1.0,   0.6,   0.4,   0.2,   0.0,  -0.8,  -0.6,  -0.4,  -0.2,   0.0,
0.6,   1.0,   0.6,   0.4,   0.2,  -0.6,  -0.8,  -0.6,  -0.4,  -0.2,
0.4,   0.6,   1.0,   0.6,   0.4,  -0.4,  -0.6,  -0.8,  -0.6,  -0.4,
0.2,   0.4,   0.6,   1.0,   0.6,  -0.2,  -0.4,  -0.6,  -0.8,  -0.6,
0.0,   0.2,   0.4,   0.6,   1.0,   0.0,  -0.2,  -0.4,  -0.6,  -0.8,
-0.8,  -0.6,  -0.4,  -0.2,   0.0,   1.0,   0.6,   0.4,   0.2,   0.0,
-0.6,  -0.8,  -0.6,  -0.4,  -0.2,   0.6,   1.5,   1.0,   0.4,   0.2,
-0.4,  -0.6,  -0.8,  -0.6,  -0.4,   0.4,   1.0,   2.0,   1.2,   0.4,
-0.2,  -0.4,  -0.6,  -0.8,  -0.6,   0.2,   0.4,   1.2,   2.5,   1.4,
0.0,  -0.2,  -0.4,  -0.6,  -0.8,   0.0,   0.2,   0.4,   1.4,   3.0),10,10)
bv_5 <- lapply(1, mvrnorm, n=200, mu=rep(0,10), Sigma=G_5)
sire5<-lapply(bv_5, function(x) data.frame(sire=rep(1:nrow(x),each=4), rpt=rep(1:4,nrow(x)),
res1=rnorm(800,0,1.35^2),res2=rnorm(800,0,1.35^2),res3=rnorm(800,0,1.35^2),res4=rnorm(800,0,1.35^2),res5=rnorm(800,0,1.35^2),res6=rnorm(800,0,1.35^2),res7=rnorm(800,0,1.35^2),res8=rnorm(800,0,1.35^2),res9=rnorm(800,0,1.35^2),res10=rnorm(800,0,1.35^2),
bv1=rep(x[,1],each=4),bv2=rep(x[,2],each=4),bv3=rep(x[,3],each=4),bv4=rep(x[,4],each=4),bv5=rep(x[,5],each=4),bv6=rep(x[,6],each=4),bv7=rep(x[,7],each=4),bv8=rep(x[,8],each=4),bv9=rep(x[,9],each=4),bv10=rep(x[,10],each=4)))
data5<-lapply(sire5, function(x) cbind(x, trait1=x$res1+x$bv1, trait2=x$res2+x$bv2, trait3=x$res3+x$bv3,trait4=x$res4+x$bv4,trait5=x$res5+x$bv5,trait6=x$res6+x$bv6,trait7=x$res7+x$bv7,trait8=x$res8+x$bv8,trait9=x$res9+x$bv9,trait10=x$res10+x$bv10))
# set parameter expanded prior
prior1<-list(R=list(V=diag(5)*0.02, nu=6),
G=list(G1=list(V=diag(5),
nu=5,
alpha.mu=rep(0,5),
alpha.V=diag(5)*1000)))
prior_P <- list(R=list(V=diag(5)*0.02, nu=6))
model1.1<-MCMCglmm(cbind(trait1, trait2, trait3, trait4, trait5)  ~ trait-1,
rcov=~us(trait):units,
family=c("gaussian","gaussian","gaussian","gaussian", "gaussian"),
prior=prior_P,
data=data1[[1]], verbose=FALSE)
library(rgl)
source('~/Documents/GitHub/mcmc-plus-tensor/Matrix_Tensor_Functions/derived.stats2.R', chdir = TRUE)
source('~/Documents/GitHub/mcmc-plus-tensor/Matrix_Tensor_Functions/psb2.R', chdir = TRUE)
model1.1<-MCMCglmm(cbind(trait1, trait2, trait3, trait4, trait5)  ~ trait-1,
rcov=~us(trait):units,
family=c("gaussian","gaussian","gaussian","gaussian", "gaussian"),
prior=prior_P,
data=data1[[1]], verbose=FALSE, burnin=50000, thin=100, nitt=150000)
model1.2<-MCMCglmm(cbind(trait6, trait7, trait8, trait9, trait10) ~ trait-1,
random=~us(trait):sire, rcov=~us(trait):units,
family=c("gaussian","gaussian","gaussian","gaussian", "gaussian"),
prior=prior_P,
data=data1[[1]], verbose=FALSE, burnin=50000, thin=100, nitt=150000)
model1.2<-MCMCglmm(cbind(trait6, trait7, trait8, trait9, trait10) ~ trait-1,
rcov=~us(trait):units,
family=c("gaussian","gaussian","gaussian","gaussian", "gaussian"),
prior=prior_P,
data=data1[[1]], verbose=FALSE, burnin=50000, thin=100, nitt=150000)
model4.1<-MCMCglmm(cbind(trait1, trait2, trait3, trait4, trait5)  ~ trait-1,
rcov=~us(trait):units,
family=c("gaussian","gaussian","gaussian","gaussian", "gaussian"),
prior=prior_P, data=data4[[1]],
verbose=FALSE, burnin=50000, thin=100, nitt=150000)
model4.2<-MCMCglmm(cbind(trait6, trait7, trait8, trait9, trait10) ~ trait-1,
rcov=~us(trait):units,
family=c("gaussian","gaussian","gaussian","gaussian", "gaussian"),
prior=prior_P, data=data4[[1]], verbose=FALSE, burnin=50000, thin=100, nitt=150000)
ls()
?save
save(list(model1.1, model1.2, model4.1, model4.2), file = P_models1-4_ecolLetts.RData)
save(list(model1.1, model1.2, model4.1, model4.2), file = "P_models1-4_ecolLetts.RData")
P_model1.1 <- model1.1
P_model1.2 <- model1.2
P_model4.1 <- model4.1
P_model4.2 <- model4.2
ffs <- list(P_model1.1, P_model1.2, P_model4.1, P_model4.2)
save(ffs, file = "P_models1-4_ecolLetts.RData")
psb2(P_model1.1, P_model1.2, method = "P")
psb2(P_model1.1, P_model1.2, method = "P", no.traits = 5)
psb2(P_model4.1, P_model4.2, method = "P", no.traits = 5)
model1.2<-MCMCglmm(cbind(5*trait6, 5*trait7, 5*trait8, 5*trait9, 5*trait10) ~ trait-1,
rcov=~us(trait):units,
family=c("gaussian","gaussian","gaussian","gaussian", "gaussian"),
prior=prior_P,
data=data1[[1]], verbose=FALSE, burnin=50000, thin=100, nitt=150000)
psb2(P_model1.1, P_model1.2, method = "P", no.traits = 5)
psb2(P_model1.1, P_model1.2, method = "P", no.traits = 5)
summary(P_model1.2)
